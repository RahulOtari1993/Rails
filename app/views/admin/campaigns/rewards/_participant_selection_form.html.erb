<div class="modal fade text-left" id="participant_selection_reward" tabindex="-1" role="dialog" aria-labelledby="reward_participant" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Users</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
              <span class="error" id="participant_selection_reward_error" style="display:none;"></span>

              <div class="content-wrapper">
                <div class="content-body">
                  <%= form_with(url: participant_selection_admin_campaign_reward_path(@reward.campaign, @reward), method: :post, local: true, id: "participant_selection_reward_form") do |f| %>
                    <section id="data-list-view" class="data-list-view-header">
                      <div class="table-responsive">
                        <table class="table participant-list-view">
                            <thead>
                              <tr>
                                <th>Select</th>
                                <th>User Name</th>
                                <th>Email</th>
                              </tr>
                            </thead>
                            <tbody>
                              <% if @participants.present? %>
                                <% @participants.each do |participant|%>
                                  <tr>
                                    <td scope="row">
                                      <div class="vs-checkbox-con vs-checkbox-primary">
                                        <input type="checkbox" value="<%= participant.id %>" name="participant_ids[]" class="participant-selection-id">
                                        <span class="vs-checkbox vs-checkbox-sm">
                                          <span class="vs-checkbox--check">
                                            <i class="vs-icon feather icon-check"></i>
                                          </span>
                                        </span>
                                      </div>
                                    </td>
                                    <td scope="row"><%= participant.first_name %></td>
                                    <td><%= participant.email %></td>
                                  </tr>
                                <% end %>
                              <% end %>
                            </tbody>
                        </table>
                      </div>
                    </section>

                  <% end %>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-primary assign-reward-btn">Assign Reward</button>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">

  // Participant selection reward form validation UI -- start
  $('.assign-reward-btn').on('click', function(e) {
    var selectedParticipants = 0;
    var claimedParticipants = 0;
    var totalParticipants = 0;
    var claimRemains = 0;

    var rewardQuantity = <%= @reward.limit.to_i %> ;

    claimedParticipants = <%= @reward.reward_participants.length %>
    claimRemains =  rewardQuantity - claimedParticipants

    selectedParticipants = $('.participant-selection-id:checked').length;
    totalParticipants = claimedParticipants + selectedParticipants

    // check for reward quantity and total participants selected to claim
    if (selectedParticipants > 0) {
      if (rewardQuantity >= totalParticipants) {
        $('#participant_selection_reward_form').submit();
        $('#participant_selection_reward').modal('hide');
      } else {
        message = `More users(${selectedParticipants}) are selected than the reward quantity(${claimRemains})`
        $('#participant_selection_reward_error').text(message).show();
      }
    } else {
      message = "Please select the users to assign this reward."
      $('#participant_selection_reward_error').text(message).show();
    }
  });
  // Participant selection reward form validation UI -- end


  // initialize the participants datatable
  $(".participant-list-view").DataTable({
    aoColumnDefs: [
                    { 'bSortable': false, 'aTargets': [0]}
                  ]
  });
</script>>
