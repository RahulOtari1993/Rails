<section class="section_que read_article_section">
  <div class="container">
    <div class="row">
      <div class="col-12 offset-lg-2 col-lg-8">
        <div class="box3">
          <%= render 'non_login/challenge_header_details' %>

          <div class="progress">
            <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
          <div class="row">
            <div class="col-md-12 article-body ql-editor">
              <%= raw(@challenge.content).html_safe %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script type="text/javascript">
  var counter = 0;
  $(document).ready(function () {
    progress();
    $('.read_article_section .article-body').on('scroll', progress);
  });

  function progress() {
    var windowScrollTop = $('.read_article_section .article-body').scrollTop();
    var docHeight = $('.read_article_section .article-body').prop('scrollHeight');
    var windowHeight = $('.read_article_section .article-body').height();

    var progress = (windowScrollTop / (docHeight - (windowHeight))) * 100;

    if (isNaN(progress)) {
      progress = 0
    }

    $(".progress-bar").css("width", progress + "%");
    if (progress == 100) {
      $(".progress-bar").css('background-color', '#28a745');
    } else {
      $(".progress-bar").css('background-color', '#dc3545');
    }

    if (progress == 100 && counter == 0) {
      counter = counter + 1;
      $(".progress-bar").css("width", progress + "%");
      submitChallenge();
    }
  }

  function submitChallenge() {
    var identifier = '<%= @identifier %>';

    $.ajax({
      url: `/participants/submissions/challenge`,
      type: 'POST',
      dataType: 'JSON',
      data: {identifier: identifier},
      success: function (data) {
        if (data.success) {
          swalNotify('Challenge Submission', data.message);
        } else {
          swalNotify('Challenge Submission', data.message);
        }
      }
    });
  }
</script>

<style media="screen">
  .article-body {
    max-height: calc(100vh - 210px);
    overflow-y: auto;
  }

  .progress {
    height: 10px;
    margin-bottom: 15px;
  }

  .progress-bar {
    background-color: #dc3545;
  }

  /* width */
  ::-webkit-scrollbar {
    width: 10px;
  }

  /* Track */
  ::-webkit-scrollbar-track {
    box-shadow: inset 0 0 0px transparent;
    border-radius: 0px;
  }

  /* Handle */
  ::-webkit-scrollbar-thumb {
    background: transparent;
    border-radius: 0px;
  }

  /* Handle on hover */
  ::-webkit-scrollbar-thumb:hover {
    background: transparent;
  }
</style>
